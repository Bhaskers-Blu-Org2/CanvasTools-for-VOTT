<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="css/palette.css" />
    <title>CanvasTools Samples - Palette Swatches</title>
</head>

<body>
    <div id="canvasToolsDiv">
        <div id="paletteDiv">
            <h2>Palette</h2>
        </div>
        <div id="swatchesDiv">
            <h2>Swatches</h2>
        </div>
    
    </div>
    <div>
        <div>
            <label for="lightnessRange">Lightness</label>
            <input type="range" id="lightnessRange" name="lightness" min="0" max="1" value="0.6" step="0.025">
            <span id="lightnessRangeValue">0.6 / [0, 1]</span>
        </div>

        <div>
            <label for="lightnessVariationRange">Lightness Variation</label>
            <input type="range" id="lightnessVariationRange" name="lightnessVariation" min="0" max="0.5" value="0.0" step="0.025">
            <span id="lightnessVariationRangeValue">0.0 / [0, 0.5]</span>
        </div>
    
        <div>
            <label for="minGraynessRange">Min Grayness</label>
            <input type="range" id="minGraynessRange" name="minGrayness" min="0" max="1" value="0.2" step="0.025">
            <span id="minGraynessRangeValue">0.2 / [0, 1]</span>
        </div>
        <div>
            <label for="maxGraynessRange">Max Grayness</label>
            <input type="range" id="maxGraynessRange" name="maxGrayness" min="0" max="2" value="2" step="0.05">
            <span id="maxGraynessRangeValue">2 / [0, 2]</span>
        </div>

        <div>
            <label for="swatchesRange">Swatches #</label>
            <input type="range" id="swatchesRange" name="swatches" min="0" max="20" value="10" step="1">
            <span id="swatchesRangeValue">10 / [0, 20]</span>
            <button id="addMoreSwatches" >Add 5 more colors</button>
        </div>
    </div>
</body>
<script src="./../shared/js/ct.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", (e) => {
        const ct = CanvasTools;
        const paletteCanvasDiv = document.getElementById("paletteDiv");
        const paletteCanvas = document.createElement("canvas");
        paletteCanvas.width = 800;
        paletteCanvas.height = 800;

        paletteCanvasDiv.appendChild(paletteCanvas);

        const swatchesCanvasDiv = document.getElementById("swatchesDiv");
        const swatchesCanvas = document.createElement("canvas");
        swatchesCanvas.width = 800;
        swatchesCanvas.height = 800;

        swatchesCanvasDiv.appendChild(swatchesCanvas);
        
        const LABColor = CanvasTools.Core.Colors.LABColor;
        const RGBColor = CanvasTools.Core.Colors.RGBColor;
        const Palette = CanvasTools.Core.Colors.Palette;
        
        const lightnessRange = document.getElementById("lightnessRange");
        const lightnessVariationRange = document.getElementById("lightnessVariationRange");
        const minGraynessRange = document.getElementById("minGraynessRange");
        const maxGraynessRange = document.getElementById("maxGraynessRange");
        const swatchesRange = document.getElementById("swatchesRange");
        const addMoreColors = document.getElementById("addMoreSwatches");

        const lightnessRangeValueSpan = document.getElementById("lightnessRangeValue");
        const lightnessVariationRangeValueSpan = document.getElementById("lightnessVariationRangeValue");
        const minGraynessRangeValueSpan = document.getElementById("minGraynessRangeValue");
        const maxGraynessRangeValueSpan = document.getElementById("maxGraynessRangeValue");
        const swatchesRangeValueSpan = document.getElementById("swatchesRangeValue");

        let palette;
        let swatches;

        function redrawPalette() {
            const lightness = Number.parseFloat(lightnessRange.value);
            const lightnessVariation = Number.parseFloat(lightnessVariationRange.value);
            const minGrayness = Number.parseFloat(minGraynessRange.value);
            const maxGrayness = Number.parseFloat(maxGraynessRange.value);
            const swatchesCount = Number.parseInt(swatchesRange.value);

            const paletteSettings = {
                lightness: lightness,
                lightnessVariation: lightnessVariation,
                minGrayness: minGrayness,
                maxGrayness: maxGrayness,
                granularity: 50,
                abRange: 1.3,
            };

            palette = new Palette(paletteSettings);
            palette.gamut().then((gamut) => {
                initRulers(paletteCanvas);
                drawGamut(paletteCanvas, gamut);
            });

            palette.swatches(swatchesCount).then((gamut) => {
                swatches = gamut;
                initRulers(swatchesCanvas);
                drawGamut(swatchesCanvas, swatches, 14);
            });
        }

        lightnessRange.addEventListener("change", (e) => {
            redrawPalette();
            lightnessRangeValueSpan.innerHTML = `${lightnessRange.value} / [${lightnessRange.min}, ${lightnessRange.max}]`;
        });

        lightnessVariationRange.addEventListener("change", (e) => {
            redrawPalette();
            lightnessVariationRangeValueSpan.innerHTML = `${lightnessVariationRange.value} / [${lightnessVariationRange.min}, ${lightnessVariationRange.max}]`;
        });

        minGraynessRange.addEventListener("change", (e) => {
            if (minGraynessRange.value >= maxGraynessRange.value) {
                minGraynessRange.value = maxGraynessRange.value - 0.25;
            }

            redrawPalette();
            minGraynessRangeValueSpan.innerHTML = `${minGraynessRange.value} / [${minGraynessRange.min}, ${minGraynessRange.max}]`;
        });

        maxGraynessRange.addEventListener("change", (e) => {
            if (maxGraynessRange.value <= minGraynessRange.value) {
                maxGraynessRange.value = minGraynessRange.value + 0.25;
            }

            redrawPalette();
            maxGraynessRangeValueSpan.innerHTML = `${maxGraynessRange.value} / [${maxGraynessRange.min}, ${maxGraynessRange.max}]`;
        });

        swatchesRange.addEventListener("change", (e) => {
            redrawPalette();
            swatchesRangeValueSpan.innerHTML = `${swatchesRange.value} / [${swatchesRange.min}, ${swatchesRange.max}]`;
        });

        addMoreColors.addEventListener("click", (e) => {
            palette.more(swatches, 5).then((gamut) => {
                swatches = swatches.concat(gamut);
                drawGamut(swatchesCanvas, gamut, 14);
            });
        });

        redrawPalette();
    });

    function initRulers(canvas) {
        const width = canvas.width;
        const height = canvas.height;
        const context = canvas.getContext("2d");

        const cx = width / 2;
        const cy = height / 2;

        context.fillStyle = "#ffffff";
        context.fillRect(0, 0, width, height);
        context.strokeStyle = "#000000";
        context.beginPath(); 
        context.moveTo(0, cy);
        context.lineTo(width, cy);
        context.moveTo(cx, 0);
        context.lineTo(cx, height);
        context.stroke();

        context.strokeRect(cx / 3, cy / 3, width * 2 / 3, height * 2 / 3);
    }

    function drawGamut(canvas, gamut, rs = 7) {
        const width = canvas.width;
        const height = canvas.height;
        const context = canvas.getContext("2d");

        const cx = width / 2;
        const cy = height / 2;

        context.strokeStyle = "black";
        gamut.forEach((color) => {
            const a = color.lab.a;
            const b = color.lab.b;
            const x = cx + width / 3 * a;
            const y = cy - height / 3 * b;

            context.fillStyle = color.rgb.toHex();
            context.fillRect(x - rs, y - rs, rs * 2, rs * 2);
        });
    }

</script>

</html>