<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="css/index.css" />
    <title>CanvasTools Demo</title>
</head>

<body>
    <div id="ctZone">
        <div id="toolbarzone">
        </div>
        <div id="selectionzone">
            <div id="editorzone"></div>
        </div>
    </div>

    <div>Some text <input type="text" /></div>
</body>
<script src="./js/ct.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", (e) => {
        var ct = CanvasTools;
        var sz = document.getElementById("editorzone");
        var tz = document.getElementById("toolbarzone");

        var editor = new ct.Editor(sz);
        editor.addToolbar(tz, ct.Editor.FullToolbarSet, "./images/icons/");

        var incrementalRegionID = 100;

        editor.onSelectionEnd = (regionData) => {
            let id = (incrementalRegionID++).toString();
            let tags = generateTagDescriptor();            
            editor.RM.addRegion(id, regionData, tags);
            console.log(regionData.toString());
        }

        let primaryTags = [
            new ct.Core.Tag("Awesome", 0),
            new ct.Core.Tag("Amazing", "#e53"),
            new ct.Core.Tag("Brilliante", 60),
        ];

        let secondaryTags = [
            new ct.Core.Tag("Yes", 100),
            new ct.Core.Tag("No", 130),
            new ct.Core.Tag("Unknown", 160),
        ];

        let ternaryTags = [
            new ct.Core.Tag("one", 200),
            new ct.Core.Tag("two", 230),
            new ct.Core.Tag("many", 260),
        ]

        function generateTagDescriptor() {
            let rnd = Math.random();
            let rnd3 = () => {
                return Math.round(Math.random() * 2);
            };

            let tags;
            
            /* if (rnd < 0.2) {
                tags = new ct.Core.TagsDescriptor(null, [secondaryTags[rnd3()], ternaryTags[rnd3()]]);
            } else if (rnd < 0.4) {
                tags = new ct.Core.TagsDescriptor(primaryTags[rnd3()], [secondaryTags[rnd3()], ternaryTags[rnd3()]]);
            } else if (rnd < 0.6) {
                tags = new ct.Core.TagsDescriptor(primaryTags[rnd3()]);
            } else if (rnd < 0.8) {
                tags = new ct.Core.TagsDescriptor([primaryTags[rnd3()]]);
            } else {
            {
                tags = null;
            } */

            tags = new ct.Core.TagsDescriptor([primaryTags[rnd3()]]);
            return tags;
        }
        
        editor.onRegionMove = (id, regionData) => {
            //console.log(`Moved ${id}: {${x}, ${y}} x {${width}, ${height}}`);
        }

        //editor.FilterPipeline.addFilter(ct.Filters.ContrastFilter(100));
        //editor.FilterPipeline.addFilter(ct.Filters.BrightnessFilter(100));
        //editor.FilterPipeline.addFilter(ct.Filters.SaturationFilter(128));
        //editor.FilterPipeline.addFilter(ct.Filters.BlurDiffFilter(4));
        

        // Upload background image for selection 
        let imagePath = "./../images/background-snow.jpg";
        let image = new Image();
        image.addEventListener("load", (e) => {
            editor.addContentSource(e.target);
        });
        image.src = imagePath;
    });
</script>

</html>