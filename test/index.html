<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="css/index.css" />
    <title>CanvasTools Demo</title>
</head>

<body>
    <div id="ctZone">
        <div id="toolbarzone">
        </div>
        <div id="selectionzone">
            <div id="editorzone"></div>
        </div>
    </div>

    <div>Some text <input type="text" /></div>
</body>
<script src="./js/ct.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", (e) => {
        var ct = CanvasTools;
        var sz = document.getElementById("editorzone");
        var tz = document.getElementById("toolbarzone");

        var editor = new ct.Editor(sz);
        editor.addToolbar(tz, ct.Editor.FullToolbarSet, "./images/icons/");

        var incrementalRegionID = 100;

        editor.onSelectionEnd = (commit) => {
            let r = commit.boundRect;
            
            let tags = generateTagDescriptor();

            if (commit.meta !== undefined && commit.meta.point !== undefined) {
                let point = commit.meta.point;
                editor.RM.addPointRegion((incrementalRegionID++).toString(), new ct.Core.Point2D(point.x, point.y), tags);
            } else {
                editor.RM.addRectRegion((incrementalRegionID++).toString(), new ct.Core.Point2D(r.x1, r.y1), new ct.Core.Point2D(r.x2, r.y2), tags);
            }
        }

        let primaryTag = new ct.Core.Tag(
                        (Math.random() > 0.5) ? "Awesome" : "Brilliante",
                        Math.floor(Math.random() * 360.0));
        let secondaryTag = new ct.Core.Tag(
                        (Math.random() > 0.5) ? "Yes" : "No",
                        Math.floor(Math.random() * 360.0));
        let ternaryTag = new ct.Core.Tag(
                        (Math.random() > 0.5) ? "one" : "two",
                        Math.floor(Math.random() * 360.0));

        function generateTagDescriptor() {
            let tags = 
                (Math.random() < 0.3) ?        
                    new ct.Core.TagsDescriptor(primaryTag, [secondaryTag, ternaryTag]):
                ((Math.random() > 0.5) ? 
                    new ct.Core.TagsDescriptor(secondaryTag, [ternaryTag, primaryTag]):
                    new ct.Core.TagsDescriptor(ternaryTag, [primaryTag, secondaryTag]));

            return tags
        }
        
        editor.onRegionMove = (id, x, y, width, height) => {
            console.log(`Moved ${id}: {${x}, ${y}} x {${width}, ${height}}`);
        }

        // Upload background image for selection 
        let imagePath = "./../images/background-forest-v.jpg";
        let image = new Image();
        image.addEventListener("load", (e) => {
            editor.addContentSource(e.target);
        });
        image.src = imagePath;
    });
</script>

</html>